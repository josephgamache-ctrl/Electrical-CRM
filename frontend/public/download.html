<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>Download Pem2 Services App</title>
  <link rel="icon" href="/icons/icon-192x192.png">
  <link rel="apple-touch-icon" href="/icons/icon-192x192.png">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: linear-gradient(135deg, #1976d2 0%, #1565c0 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .container {
      background: white;
      border-radius: 20px;
      padding: 32px 24px;
      max-width: 400px;
      width: 100%;
      text-align: center;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }

    .logo {
      width: 100px;
      height: 100px;
      border-radius: 22px;
      margin-bottom: 20px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.15);
    }

    h1 {
      color: #1976d2;
      font-size: 24px;
      margin-bottom: 6px;
    }

    .subtitle {
      color: #666;
      font-size: 15px;
      margin-bottom: 24px;
    }

    /* iOS-specific install card */
    .ios-install-card {
      background: linear-gradient(135deg, #007AFF 0%, #5856D6 100%);
      border-radius: 16px;
      padding: 24px 20px;
      margin-bottom: 20px;
      color: white;
    }

    .ios-install-card h2 {
      font-size: 18px;
      margin-bottom: 20px;
      font-weight: 600;
    }

    .ios-step {
      display: flex;
      align-items: flex-start;
      gap: 14px;
      margin-bottom: 16px;
      text-align: left;
    }

    .ios-step:last-child {
      margin-bottom: 0;
    }

    .step-number {
      background: rgba(255,255,255,0.25);
      width: 28px;
      height: 28px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 14px;
      flex-shrink: 0;
    }

    .step-content {
      flex: 1;
    }

    .step-content p {
      font-size: 15px;
      line-height: 1.4;
    }

    .step-icon {
      display: inline-flex;
      align-items: center;
      background: rgba(255,255,255,0.2);
      padding: 4px 10px;
      border-radius: 6px;
      margin-top: 6px;
      font-size: 13px;
    }

    .step-icon svg {
      width: 18px;
      height: 18px;
      margin-right: 6px;
    }

    .safari-note {
      background: rgba(255,255,255,0.15);
      border-radius: 10px;
      padding: 12px;
      margin-top: 16px;
      font-size: 13px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .install-btn {
      background: #1976d2;
      color: white;
      border: none;
      padding: 16px 40px;
      font-size: 17px;
      font-weight: 600;
      border-radius: 12px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 10px;
      transition: all 0.2s;
      margin-bottom: 16px;
      width: 100%;
      justify-content: center;
    }

    .install-btn:hover {
      background: #1565c0;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(25, 118, 210, 0.4);
    }

    .install-btn svg {
      width: 22px;
      height: 22px;
    }

    .open-app-btn {
      background: #4caf50;
      color: white;
      border: none;
      padding: 14px 32px;
      font-size: 16px;
      font-weight: 600;
      border-radius: 10px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 10px;
      transition: all 0.2s;
      text-decoration: none;
      width: 100%;
      justify-content: center;
    }

    .open-app-btn:hover {
      background: #43a047;
    }

    .instructions {
      background: #f5f5f5;
      border-radius: 12px;
      padding: 20px;
      text-align: left;
      margin-top: 20px;
    }

    .instructions h3 {
      color: #333;
      margin-bottom: 14px;
      font-size: 15px;
    }

    .instructions ol {
      color: #555;
      padding-left: 20px;
      line-height: 1.7;
      font-size: 14px;
    }

    .instructions li {
      margin-bottom: 6px;
    }

    .platform-note {
      background: #e3f2fd;
      border-radius: 8px;
      padding: 10px 14px;
      margin-top: 14px;
      font-size: 13px;
      color: #1565c0;
    }

    .login-info {
      background: #f0f7ff;
      border-radius: 12px;
      padding: 18px;
      margin-top: 20px;
      border: 1px solid #bbdefb;
    }

    .login-info h3 {
      color: #1565c0;
      margin-bottom: 12px;
      font-size: 15px;
    }

    .login-info p {
      color: #555;
      font-size: 14px;
      line-height: 1.6;
    }

    .login-info code {
      background: #fff;
      padding: 3px 10px;
      border-radius: 6px;
      font-family: -apple-system, monospace;
      color: #1565c0;
      font-weight: 600;
      font-size: 15px;
      display: inline-block;
      margin: 4px 0;
    }

    .hidden {
      display: none !important;
    }

    #already-installed {
      background: #e8f5e9;
      color: #2e7d32;
      font-weight: 600;
      padding: 14px;
      border-radius: 10px;
      margin-bottom: 16px;
      font-size: 15px;
    }
  </style>
</head>
<body>
  <div class="container">
    <img src="/icons/icon-192x192.png" alt="Pem2 Services" class="logo">
    <h1>Pem2 Services</h1>
    <p class="subtitle">Inventory & Job Management</p>

    <p id="already-installed" class="hidden">
      ‚úì App is installed on your device!
    </p>

    <!-- iOS Instructions - shown prominently for iPhone users -->
    <div id="ios-install-card" class="ios-install-card hidden">
      <h2>üì≤ Add to Home Screen</h2>

      <div class="ios-step">
        <div class="step-number">1</div>
        <div class="step-content">
          <p>Tap the <strong>Share</strong> button at the bottom of Safari</p>
          <div class="step-icon">
            <svg viewBox="0 0 24 24" fill="currentColor">
              <path d="M16 5l-1.42 1.42-1.59-1.59V16h-1.98V4.83L9.42 6.42 8 5l4-4 4 4zm4 5v11c0 1.1-.9 2-2 2H6c-1.11 0-2-.9-2-2V10c0-1.11.89-2 2-2h3v2H6v11h12V10h-3V8h3c1.1 0 2 .89 2 2z"/>
            </svg>
            Share Button
          </div>
        </div>
      </div>

      <div class="ios-step">
        <div class="step-number">2</div>
        <div class="step-content">
          <p>Scroll down and tap <strong>"Add to Home Screen"</strong></p>
          <div class="step-icon">
            <svg viewBox="0 0 24 24" fill="currentColor">
              <path d="M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10h-4v4h-2v-4H7v-2h4V7h2v4h4v2z"/>
            </svg>
            Add to Home Screen
          </div>
        </div>
      </div>

      <div class="ios-step">
        <div class="step-number">3</div>
        <div class="step-content">
          <p>Tap <strong>"Add"</strong> in the top right corner</p>
        </div>
      </div>

      <div class="safari-note">
        <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
        </svg>
        Make sure you're using Safari for this to work!
      </div>
    </div>

    <!-- Android/Desktop Install Button -->
    <button id="install-btn" class="install-btn hidden">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
        <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
      </svg>
      Install App
    </button>

    <a href="/" class="open-app-btn">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
        <path d="M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"/>
      </svg>
      Open App in Browser
    </a>

    <!-- Non-iOS instructions -->
    <div class="instructions hidden" id="manual-instructions">
      <h3>Installation Steps:</h3>
      <div id="android-instructions" class="hidden">
        <ol>
          <li>Tap the <strong>menu</strong> (‚ãÆ) in Chrome</li>
          <li>Tap <strong>"Install app"</strong> or <strong>"Add to Home Screen"</strong></li>
          <li>Tap <strong>"Install"</strong> to confirm</li>
        </ol>
        <div class="platform-note">
          üì± Android - Use Chrome for best results
        </div>
      </div>
      <div id="desktop-instructions" class="hidden">
        <ol>
          <li>Click the <strong>install icon</strong> in the address bar</li>
          <li>Or click menu (‚ãÆ) ‚Üí <strong>"Install Pem2 Services"</strong></li>
          <li>Click <strong>"Install"</strong></li>
        </ol>
        <div class="platform-note">
          üíª Works in Chrome, Edge, or Brave
        </div>
      </div>
    </div>

    <div class="login-info">
      <h3>üîê Login Information</h3>
      <p>
        <strong>Username:</strong> first initial + last name<br>
        Example: John Smith ‚Üí <code>jsmith</code><br><br>
        <strong>Password:</strong> <code>Pem2Services2026</code><br><br>
        <em>Change your password after first login!</em>
      </p>
    </div>
  </div>

  <script>
    let deferredPrompt;
    const installBtn = document.getElementById('install-btn');
    const alreadyInstalled = document.getElementById('already-installed');
    const iosCard = document.getElementById('ios-install-card');
    const manualInstructions = document.getElementById('manual-instructions');

    // Detect platform
    const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
    const isAndroid = /Android/.test(navigator.userAgent);
    const isDesktop = !isIOS && !isAndroid;
    const isStandalone = window.matchMedia('(display-mode: standalone)').matches ||
                         window.navigator.standalone === true;

    // Check if already installed
    if (isStandalone) {
      alreadyInstalled.classList.remove('hidden');
      // Hide install instructions
    } else if (isIOS) {
      // Show iOS-specific prominent install card
      iosCard.classList.remove('hidden');
    } else if (isAndroid) {
      // Show install button and Android instructions
      installBtn.classList.remove('hidden');
      manualInstructions.classList.remove('hidden');
      document.getElementById('android-instructions').classList.remove('hidden');
    } else {
      // Desktop
      installBtn.classList.remove('hidden');
      manualInstructions.classList.remove('hidden');
      document.getElementById('desktop-instructions').classList.remove('hidden');
    }

    // Listen for install prompt (Android/Desktop)
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      installBtn.classList.remove('hidden');
    });

    // Handle install button click
    installBtn.addEventListener('click', async () => {
      if (deferredPrompt) {
        deferredPrompt.prompt();
        const { outcome } = await deferredPrompt.userChoice;
        if (outcome === 'accepted') {
          installBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="22" height="22"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg> Installing...';
          setTimeout(() => {
            alreadyInstalled.classList.remove('hidden');
            installBtn.style.display = 'none';
            manualInstructions.style.display = 'none';
          }, 2000);
        }
        deferredPrompt = null;
      } else {
        // Fallback - scroll to manual instructions
        manualInstructions.scrollIntoView({ behavior: 'smooth' });
      }
    });

    // Listen for successful install
    window.addEventListener('appinstalled', () => {
      alreadyInstalled.classList.remove('hidden');
      installBtn.style.display = 'none';
      iosCard.style.display = 'none';
      manualInstructions.style.display = 'none';
    });
  </script>
</body>
</html>
